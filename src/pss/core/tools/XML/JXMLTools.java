package pss.core.tools.XML;

import java.util.Date;

import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.w3c.dom.Text;

import pss.core.tools.JDateTools;
import pss.core.tools.JExcepcion;
import pss.core.tools.formatters.JNumberFormatter;

/**
 * <p>
 * Title:
 * </p>
 * <p>
 * Description:
 * </p>
 * <p>
 * Copyright: Copyright (c) 2003
 * </p>
 * <p>
 * Company:
 * </p>
 * 
 * @author not attributable
 * @version 1.0
 */

public class JXMLTools {

	public static final String DATATYPE_ELEMENT="E";
	public static final String DATATYPE_ATTRIBUTE="A";

	public JXMLTools() {
	}

	/*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * Agrega al elemento zPadre, un elemento como hijo o un atributo, dependiendo de como fue configurado
	 ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	public static void addData(Element zPadre, String zTagElem, long zDatoElem, Element zRoot, String zTipoDato) throws Exception {
		addData(zPadre, zTagElem, JNumberFormatter.formatNumberToString(zDatoElem), zRoot, zTipoDato);
		// this.AddData(zPadre, zTagElem, String.valueOf(zDatoElem)) ;
	}

	/*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * Agrega al elemento zPadre, un elemento como hijo o un atributo, dependiendo de como fue configurado
	 ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	public static void addData(Element zPadre, String zTagElem, double zDatoElem, Element zRoot, String zTipoDato) throws Exception {
		addData(zPadre, zTagElem, JNumberFormatter.formatNumberToString(zDatoElem), zRoot, zTipoDato);
		// this.AddData(zPadre, zTagElem, JTools.doubleToString(zDatoElem,4)) ;
	}

	/*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * Agrega al elemento zPadre, un elemento como hijo o un atributo, dependiendo de como fue configurado
	 ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	public static void addData(Element zPadre, String zTagElem, Date zDatoElem, Element zRoot, String zTipoDato) throws Exception {
		addData(zPadre, zTagElem, JDateTools.DateToString(zDatoElem, "dd/MM/yyyy"), zRoot, zTipoDato);
	}

	/*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * Agrega al elemento zPadre, un elemento como hijo o un atributo, dependiendo de como fue configurado
	 ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	public static void addData(Element zPadre, String zTagElem, String zDatoElem, Element zRoot, String zTipoDato) throws Exception {
		if (zTagElem==null) {
			zTagElem="";
		}
		if (zDatoElem==null) {
			zDatoElem="";
		}
		if (zTagElem.equals("")) return; // si no hay un tag, no se agrega
		if (zTipoDato.equalsIgnoreCase(JXMLTools.DATATYPE_ATTRIBUTE))
		// Datos generados como ATRIBUTO //
		zPadre.setAttribute(zTagElem, zDatoElem);
		else if (zTipoDato.equalsIgnoreCase(JXMLTools.DATATYPE_ELEMENT)) {
			// Datos generados como ELEMENTO //
			Element oElem=zRoot.getOwnerDocument().createElement(zTagElem);
			// si zDatoElem trae información, se lo pone como TextNode hijo
			if (!zDatoElem.equalsIgnoreCase("")) oElem.appendChild(zRoot.getOwnerDocument().createTextNode(zDatoElem));
			zPadre.appendChild(oElem);
		}
	}

	/*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * Agrega hijos a zPadre en forma de elemento, donde el tag y el dato de cada elemento hijo es zTags[i] y zDatos[i] respectivamente
	 ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	public static void addChilds(Element zPadre, String[] zTags, String[] zDatos, Element zRoot, String zTipoDato) throws Exception {
		for(int i=0; i<zTags.length; i++)
			addData(zPadre, zTags[i], zDatos[i], zRoot, zTipoDato);
	}

	/*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
	 * En un documento XML verifica la existencia del atributo zAttrName y retorna su valor Excepciones: 1) Si el atributo no existe. 2) Si el atributo no tiene valor.
	 ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
	public static String getXMLMandatoryValue(Element zElem, String zAttrName) throws Exception {
		if (zElem.hasAttribute(zAttrName)) {
			String valor=zElem.getAttribute(zAttrName);
			if (valor.equalsIgnoreCase("")) JExcepcion.SendError("No tiene valor el atributo(obligatorio) "+zAttrName);
			return valor;
		} else JExcepcion.SendError("No existe el atributo(obligatorio) "+zAttrName);
		return "";
	}

	public static String getXMLMandatoryValueExtendedXML(Element zElem, String zAttrName) throws Exception {
		Element oAtributo=getXMLMandatoryElement(zElem, zAttrName);
		NodeList listaSubNodosAtributo=oAtributo.getChildNodes();
		if (listaSubNodosAtributo.getLength()!=1) JExcepcion.SendError("El valor del atributo(obligatorio) es invalido: "+zAttrName);
		Node oValor=listaSubNodosAtributo.item(0);
		if (!(oValor instanceof Text)) JExcepcion.SendError("El valor del atributo(obligatorio) es invalido: "+zAttrName);
		return oValor.getNodeValue();
	}

	public static Element getXMLMandatoryElement(Element zElem, String zAttrName) throws Exception {
		NodeList listaSubNodos=zElem.getElementsByTagName(zAttrName);
		Element oAtributo=null;
		// Discard Elements of SubElements
		// (only children, not grandchildren or lower)
		for(int i=0; i<listaSubNodos.getLength(); i++) {
			Element oAtributoAux=(Element) listaSubNodos.item(i);
			if (oAtributoAux.getParentNode()==zElem) {
				if (oAtributo==null) oAtributo=oAtributoAux;
				else JExcepcion.SendError("El atributo(obligatorio) debe ser único para el elemento: "+zAttrName);
			}
		}
		if (oAtributo==null) JExcepcion.SendError("No existe el atributo(obligatorio) "+zAttrName);
		return oAtributo;
	}

	public static Element getXMLElement(Element zElem, String zAttrName) throws Exception {
		NodeList listaSubNodos=zElem.getElementsByTagName(zAttrName);
		if (listaSubNodos.getLength()==0) return null;
		if (listaSubNodos.getLength()>1) JExcepcion.SendError("El atributo(obligatorio) debe ser único para el elemento: "+zAttrName);
		Element oAtributo=(Element) listaSubNodos.item(0);
		return oAtributo;
	}

	public static String getXMLValueExtendedXML(Element zElem, String zAttrName) throws Exception {
		Element oAtributo=getXMLElement(zElem, zAttrName);
		if (oAtributo==null) return "";
		NodeList listaSubNodosAtributo=oAtributo.getChildNodes();
		if (listaSubNodosAtributo.getLength()>1) JExcepcion.SendError("El valor del atributo(obligatorio) es invalido: "+zAttrName);
		if (listaSubNodosAtributo.getLength()==0) return "";
		Node oValor=listaSubNodosAtributo.item(0);
		if (!(oValor instanceof Text)) JExcepcion.SendError("El valor del atributo(obligatorio) es invalido: "+zAttrName);
		return oValor.getNodeValue();
	}

	public static void addDataExtended(Element zRoot, Element zPadre, String zAttribute, String zValue) throws Exception {
		Element attributeElement=zRoot.getOwnerDocument().createElement(zAttribute);
		attributeElement.appendChild(zRoot.getOwnerDocument().createTextNode(zValue));
		zPadre.appendChild(attributeElement);
	}

	public static void addDataExtendedElement(Element zRoot, Element zPadre, String elementName, String zAttributeName, String zAttributeValue, String zTextValue) throws Exception {
		Element attributeElement=zRoot.getOwnerDocument().createElement(elementName);
		JXMLTools.addData(attributeElement, zAttributeName, zAttributeValue, zRoot, JXMLTools.DATATYPE_ATTRIBUTE);
		attributeElement.appendChild(zRoot.getOwnerDocument().createTextNode(zTextValue));
		zPadre.appendChild(attributeElement);
	}

}
